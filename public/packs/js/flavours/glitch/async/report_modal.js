(window.webpackJsonp=window.webpackJsonp||[]).push([[536],{1565:function(e,t,a){"use strict";a.r(t);var s=a(0),o=a(3),i=a.n(o),l=a(7),c=a(20),d=a(28),r=a(5),n=a(16),u=a.n(n),h=a(18),p=a(9),g=a(21),b=a(1379),m=a(122),j=a(43),O=a(33),v=a(2),_=a(66),f=a(1677),k=a(6);const C=Object(l.d)({dislike:{id:"report.reasons.dislike",defaultMessage:"I don't like it"},dislike_description:{id:"report.reasons.dislike_description",defaultMessage:"It is not something you want to see"},spam:{id:"report.reasons.spam",defaultMessage:"It's spam"},spam_description:{id:"report.reasons.spam_description",defaultMessage:"Malicious links, fake engagement, or repetitive replies"},violation:{id:"report.reasons.violation",defaultMessage:"It violates server rules"},violation_description:{id:"report.reasons.violation_description",defaultMessage:"You are aware that it breaks specific rules"},other:{id:"report.reasons.other",defaultMessage:"It's something else"},other_description:{id:"report.reasons.other_description",defaultMessage:"The issue does not fit into other categories"},status:{id:"report.category.title_status",defaultMessage:"post"},account:{id:"report.category.title_account",defaultMessage:"profile"}});class y extends v.PureComponent{constructor(){super(...arguments),this.handleNextClick=()=>{const{onNextStep:e,category:t}=this.props;switch(t){case"dislike":e("thanks");break;case"violation":e("rules");break;default:e("statuses")}},this.handleCategoryToggle=(e,t)=>{const{onChangeCategory:a}=this.props;t&&a(e)}}render(){const{category:e,startedFrom:t,rules:a,intl:o}=this.props,i=a.size>0?["spam","violation","other"]:["spam","other"];return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.category.title",defaultMessage:"Tell us what's going on with this {type}",values:{type:o.formatMessage(C[t])}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.category.subtitle",defaultMessage:"Choose the best match"})),Object(s.a)("div",{},void 0,i.map((t=>Object(s.a)(f.a,{name:"category",value:t,checked:e===t,onToggle:this.handleCategoryToggle,label:o.formatMessage(C[t]),description:o.formatMessage(C[`${t}_description`])},t)))),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleNextClick,disabled:null===e},void 0,Object(s.a)(c.a,{id:"report.next",defaultMessage:"Next"})))]})}}var S=Object(p.connect)((e=>({rules:e.getIn(["server","server","rules"],Object(r.List)())})))(Object(d.c)(y)),M=a(35),N=a(45),x=a(969),w=a.n(x),I=a(738);const T=Object(l.d)({placeholder:{id:"report.placeholder",defaultMessage:"Type or paste additional comments"}}),R=Object(N.a)([e=>e.get("statuses"),(e,t)=>t],((e,t)=>t.map((t=>e.getIn([t,"in_reply_to_account_id"])))),{resultEqualityCheck:p.shallowEqual});var D=e=>{let{comment:t,domain:a,statusIds:o,isRemote:i,isSubmitting:l,selectedDomains:d,onSubmit:n,onChangeComment:u,onToggleDomain:h}=e;const p=Object(M.a)(),b=Object(I.b)(),m=Object(v.useRef)(!1),j=Object(v.useCallback)((()=>n()),[n]),O=Object(v.useCallback)((e=>u(e.target.value)),[u]),f=Object(v.useCallback)((e=>h(e.target.value,e.target.checked)),[h]),C=Object(v.useCallback)((e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey)&&j()}),[j]),y=Object(I.c)((e=>a?R(e,o):Object(r.List)())),S=Object(I.c)((e=>e.get("accounts"))),N=a?Object(r.OrderedSet)([a]).union(y.map((e=>S.getIn([e,"acct"],"").split("@")[1])).filter((e=>!!e))):Object(r.OrderedSet)();return Object(v.useEffect)((()=>{if(m.current)return;m.current=!0,N.forEach((e=>{h(e,!0)}));Object(r.OrderedSet)(y.filter((e=>e&&!S.has(e)))).forEach((e=>{b(Object(g.X)(e))}))})),Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.comment.title",defaultMessage:"Is there anything else you think we should know?"})),Object(s.a)("textarea",{className:"report-dialog-modal__textarea",placeholder:p.formatMessage(T.placeholder),value:t,onChange:O,onKeyDown:C,disabled:l}),i&&Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.forward_hint",defaultMessage:"The account is from another server. Send an anonymized copy of the report there as well?"})),N.map((e=>Object(s.a)("label",{className:"report-dialog-modal__toggle"},`toggle-${e}`,Object(s.a)(w.a,{checked:d.includes(e),disabled:l,onChange:f,value:e}),Object(s.a)(c.a,{id:"report.forward",defaultMessage:"Forward to {target}",values:{target:e}}))))]}),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:j,disabled:l},void 0,Object(s.a)(c.a,{id:"report.submit",defaultMessage:"Submit report"})))]})};class F extends v.PureComponent{constructor(){super(...arguments),this.handleNextClick=()=>{const{onNextStep:e}=this.props;e("statuses")},this.handleRulesToggle=(e,t)=>{const{onToggle:a}=this.props;a(e,t)}}render(){const{rules:e,selectedRuleIds:t}=this.props;return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.rules.title",defaultMessage:"Which rules are being violated?"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.rules.subtitle",defaultMessage:"Select all that apply"})),Object(s.a)("div",{},void 0,e.map((e=>Object(s.a)(f.a,{name:"rule_ids",value:e.get("id"),checked:t.includes(e.get("id")),onToggle:this.handleRulesToggle,label:e.get("text"),multiple:!0},e.get("id"))))),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleNextClick,disabled:t.size<1},void 0,Object(s.a)(c.a,{id:"report.next",defaultMessage:"Next"})))]})}}var q=Object(p.connect)((e=>({rules:e.getIn(["server","server","rules"])})))(F),z=a(1040),B=a(145),E=a(87),L=a(111),P=a(1701),A=a(109),U=a(733),Y=a(799);class $ extends v.PureComponent{constructor(){super(...arguments),this.handleStatusesToggle=(e,t)=>{const{onToggle:a}=this.props;a(e,t)}}render(){const{status:e,checked:t}=this.props;if(e.get("reblog"))return null;const a=Object(s.a)("div",{className:"status-check-box__status poll__option__text"},void 0,Object(s.a)("div",{className:"detailed-status__display-name"},void 0,Object(s.a)("div",{className:"detailed-status__display-avatar"},void 0,Object(s.a)(E.a,{account:e.get("account"),size:46})),Object(s.a)("div",{},void 0,Object(s.a)(L.a,{account:e.get("account")})," Â· ",Object(s.a)(Y.a,{visibility:e.get("visibility")}),Object(s.a)(A.a,{timestamp:e.get("created_at")}))),Object(s.a)(U.a,{status:e,media:Object(s.a)(P.a,{status:e,revealed:!1})}));return Object(s.a)(f.a,{name:"status_ids",value:e.get("id"),checked:t,onToggle:this.handleStatusesToggle,label:e.get("search_index"),labelComponent:a,multiple:!0})}}var K=Object(p.connect)((()=>{const e=Object(B.i)();return(t,a)=>{let{id:s}=a;return{status:e(t,{id:s})}}}))($);class J extends v.PureComponent{constructor(){super(...arguments),this.handleNextClick=()=>{const{onNextStep:e}=this.props;e("comment")}}render(){const{availableStatusIds:e,selectedStatusIds:t,onToggle:a,isLoading:o}=this.props;return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.statuses.title",defaultMessage:"Are there any posts that back up this report?"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.statuses.subtitle",defaultMessage:"Select all that apply"})),Object(s.a)("div",{className:"report-dialog-modal__statuses"},void 0,o?Object(s.a)(z.a,{}):e.union(t).map((e=>Object(s.a)(K,{id:e,checked:t.includes(e),onToggle:a},e)))),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleNextClick},void 0,Object(s.a)(c.a,{id:"report.next",defaultMessage:"Next"})))]})}}var W=Object(p.connect)(((e,t)=>{let{accountId:a}=t;return{availableStatusIds:Object(r.OrderedSet)(e.getIn(["timelines",`account:${a}:with_replies`,"items"])),isLoading:e.getIn(["timelines",`account:${a}:with_replies`,"isLoading"])}}))(J);class H extends v.PureComponent{constructor(){super(...arguments),this.handleCloseClick=()=>{const{onClose:e}=this.props;e()},this.handleUnfollowClick=()=>{const{dispatch:e,account:t,onClose:a}=this.props;e(Object(g.mb)(t.get("id"))),a()},this.handleMuteClick=()=>{const{dispatch:e,account:t,onClose:a}=this.props;e(Object(g.gb)(t.get("id"))),a()},this.handleBlockClick=()=>{const{dispatch:e,account:t,onClose:a}=this.props;e(Object(g.R)(t.get("id"))),a()}}render(){const{account:e,submitted:t}=this.props;return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,t?Object(s.a)(c.a,{id:"report.thanks.title_actionable",defaultMessage:"Thanks for reporting, we'll look into this."}):Object(s.a)(c.a,{id:"report.thanks.title",defaultMessage:"Don't want to see this?"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,t?Object(s.a)(c.a,{id:"report.thanks.take_action_actionable",defaultMessage:"While we review this, you can take action against @{name}:",values:{name:e.get("username")}}):Object(s.a)(c.a,{id:"report.thanks.take_action",defaultMessage:"Here are your options for controlling what you see on Mastodon:"})),e.getIn(["relationship","following"])&&Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(c.a,{id:"report.unfollow",defaultMessage:"Unfollow @{name}",values:{name:e.get("username")}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.unfollow_explanation",defaultMessage:"You are following this account. To not see their posts in your home feed anymore, unfollow them."})),Object(s.a)(_.a,{secondary:!0,onClick:this.handleUnfollowClick},void 0,Object(s.a)(c.a,{id:"account.unfollow",defaultMessage:"Unfollow"})),Object(s.a)("hr",{})]}),Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(c.a,{id:"account.mute",defaultMessage:"Mute @{name}",values:{name:e.get("username")}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.mute_explanation",defaultMessage:"You will not see their posts. They can still follow you and see your posts and will not know that they are muted."})),Object(s.a)(_.a,{secondary:!0,onClick:this.handleMuteClick},void 0,e.getIn(["relationship","muting"])?Object(s.a)(c.a,{id:"account.muted",defaultMessage:"Muted"}):Object(s.a)(c.a,{id:"report.mute",defaultMessage:"Mute"})),Object(s.a)("hr",{}),Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(c.a,{id:"account.block",defaultMessage:"Block @{name}",values:{name:e.get("username")}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.block_explanation",defaultMessage:"You will not see their posts. They will not be able to see your posts or follow you. They will be able to tell that they are blocked."})),Object(s.a)(_.a,{secondary:!0,onClick:this.handleBlockClick},void 0,e.getIn(["relationship","blocking"])?Object(s.a)(c.a,{id:"account.blocked",defaultMessage:"Blocked"}):Object(s.a)(c.a,{id:"report.block",defaultMessage:"Block"})),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleCloseClick},void 0,Object(s.a)(c.a,{id:"report.close",defaultMessage:"Done"})))]})}}var X=Object(p.connect)((()=>({})))(H);const G=Object(l.d)({close:{id:"lightbox.close",defaultMessage:"Close"}});class Q extends h.a{constructor(){super(...arguments),this.state={step:"category",selectedStatusIds:Object(r.OrderedSet)(this.props.statusId?[this.props.statusId]:[]),selectedDomains:Object(r.OrderedSet)(),comment:"",category:null,selectedRuleIds:Object(r.OrderedSet)(),isSubmitting:!1,isSubmitted:!1},this.handleSubmit=()=>{const{dispatch:e,accountId:t}=this.props,{selectedStatusIds:a,selectedDomains:s,comment:o,category:i,selectedRuleIds:l}=this.state;this.setState({isSubmitting:!0}),e(Object(b.b)({account_id:t,status_ids:a.toArray(),forward_to_domains:s.toArray(),comment:o,forward:s.size>0,category:i,rule_ids:l.toArray()},this.handleSuccess,this.handleFail))},this.handleSuccess=()=>{this.setState({isSubmitting:!1,isSubmitted:!0,step:"thanks"})},this.handleFail=()=>{this.setState({isSubmitting:!1})},this.handleStatusToggle=(e,t)=>{const{selectedStatusIds:a}=this.state;t?this.setState({selectedStatusIds:a.add(e)}):this.setState({selectedStatusIds:a.remove(e)})},this.handleDomainToggle=(e,t)=>{t?this.setState((t=>({selectedDomains:t.selectedDomains.add(e)}))):this.setState((t=>({selectedDomains:t.selectedDomains.remove(e)})))},this.handleRuleToggle=(e,t)=>{t?this.setState((t=>({selectedRuleIds:t.selectedRuleIds.add(e)}))):this.setState((t=>({selectedRuleIds:t.selectedRuleIds.remove(e)})))},this.handleChangeCategory=e=>{this.setState({category:e})},this.handleChangeComment=e=>{this.setState({comment:e})},this.handleNextStep=e=>{this.setState({step:e})}}componentDidMount(){const{dispatch:e,accountId:t}=this.props;e(Object(g.db)([t])),e(Object(j.r)(t,{withReplies:!0})),e(Object(m.o)())}render(){const{accountId:e,account:t,intl:a,onClose:o}=this.props;if(!t)return null;const{step:i,selectedStatusIds:l,selectedRuleIds:d,selectedDomains:r,comment:n,category:u,isSubmitting:h,isSubmitted:p}=this.state,g=t.get("acct").split("@")[1],b=!!g;let m;switch(i){case"category":m=Object(s.a)(S,{onNextStep:this.handleNextStep,startedFrom:this.props.statusId?"status":"account",category:u,onChangeCategory:this.handleChangeCategory});break;case"rules":m=Object(s.a)(q,{onNextStep:this.handleNextStep,selectedRuleIds:d,onToggle:this.handleRuleToggle});break;case"statuses":m=Object(s.a)(W,{onNextStep:this.handleNextStep,accountId:e,selectedStatusIds:l,onToggle:this.handleStatusToggle});break;case"comment":m=Object(s.a)(D,{onSubmit:this.handleSubmit,isSubmitting:h,isRemote:b,comment:n,domain:g,onChangeComment:this.handleChangeComment,statusIds:l,selectedDomains:r,onToggleDomain:this.handleDomainToggle});break;case"thanks":m=Object(s.a)(X,{submitted:p,account:t,onClose:o})}return Object(s.a)("div",{className:"modal-root__modal report-dialog-modal"},void 0,Object(s.a)("div",{className:"report-modal__target"},void 0,Object(s.a)(O.a,{className:"report-modal__close",title:a.formatMessage(G.close),icon:"times",onClick:o,size:20}),Object(s.a)(c.a,{id:"report.target",defaultMessage:"Report {target}",values:{target:Object(s.a)("strong",{},void 0,t.get("acct"))}})),Object(s.a)("div",{className:"report-dialog-modal__container"},void 0,m))}}Q.propTypes={accountId:i.a.string.isRequired,statusId:i.a.string,dispatch:i.a.func.isRequired,intl:i.a.object.isRequired,account:u.a.map.isRequired};t.default=Object(p.connect)((()=>{const e=Object(B.e)();return(t,a)=>{let{accountId:s}=a;return{account:e(t,s)}}}))(Object(d.c)(Q))}}]);
//# sourceMappingURL=report_modal.js.map