(window.webpackJsonp=window.webpackJsonp||[]).push([[504],{1562:function(e,t,s){"use strict";s.r(t);var a=s(0),o=s(2),n=s(7),i=s(22),r=s(28),c=s(126),d=s(9),l=s(899),h=s(691),p=s(1392),u=s(43),m=s(1039),g=s(1212),v=s(1665),b=s(110),j=s(1664),M=s(1671);const O=Object(n.d)({filter_regex:{id:"home.column_settings.filter_regex",defaultMessage:"Filter out by regular expressions"},settings:{id:"home.settings",defaultMessage:"Column settings"}});class _ extends o.PureComponent{render(){const{settings:e,onChange:t,intl:s}=this.props;return Object(a.a)("div",{},void 0,Object(a.a)("span",{className:"column-settings__section"},void 0,Object(a.a)(i.a,{id:"home.column_settings.basic",defaultMessage:"Basic"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(j.a,{settings:e,settingPath:["conversations"],onChange:t,label:Object(a.a)(i.a,{id:"direct.group_by_conversations",defaultMessage:"Group by conversation"})})),Object(a.a)("span",{className:"column-settings__section"},void 0,Object(a.a)(i.a,{id:"home.column_settings.advanced",defaultMessage:"Advanced"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(M.a,{settings:e,settingPath:["regex","body"],onChange:t,label:s.formatMessage(O.filter_regex)})))}}var f=Object(r.c)(_);var y=Object(d.connect)((e=>({settings:e.getIn(["settings","direct"])})),(e=>({onChange(t,s){e(Object(b.c)(["direct",...t],s))}})))(f),x=s(51),w=s.n(x),C=s(3),k=s.n(C),I=s(16),R=s.n(I),L=s(18),T=s(1429),D=s(21),N=s(34),S=s(82),P=s(142),q=s(8),H=s.n(q),U=s(693),$=s(733),E=s(12);class K extends o.PureComponent{renderItem(e,t,s){const{animate:o}=this.props;let n=50,i=100,r="auto",c="auto",d="auto",l="auto";1===t&&(n=100),(4===t||3===t&&s>0)&&(i=50),2===t?0===s?l="1px":c="1px":3===t?(0===s?l="1px":s>0&&(c="1px"),1===s?d="1px":s>1&&(r="1px")):4===t&&(0!==s&&2!==s||(l="1px"),1!==s&&3!==s||(c="1px"),s<2?d="1px":r="1px");const h={left:c,top:r,right:l,bottom:d,width:`${n}%`,height:`${i}%`,backgroundSize:"cover",backgroundImage:`url(${e.get(o?"avatar":"avatar_static")})`};return Object(a.a)("div",{style:h,"data-avatar-of":`@${e.get("acct")}`},e.get("id"))}render(){const{accounts:e,size:t}=this.props;return Object(a.a)("div",{className:"account__avatar-composite",style:{width:`${t}px`,height:`${t}px`}},void 0,e.take(4).map(((t,s)=>this.renderItem(t,Math.min(e.size,4),s))),e.size>4&&Object(a.a)("span",{className:"account__avatar-composite__label"},void 0,"+",e.size-4))}}K.defaultProps={animate:E.a};var A=s(33),z=s(146),W=s(109),B=s(732),V=s(947);const F=Object(n.d)({more:{id:"status.more",defaultMessage:"More"},open:{id:"conversation.open",defaultMessage:"View conversation"},reply:{id:"status.reply",defaultMessage:"Reply"},markAsRead:{id:"conversation.mark_as_read",defaultMessage:"Mark as read"},delete:{id:"conversation.delete",defaultMessage:"Delete conversation"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"}});class J extends L.a{constructor(){super(...arguments),this.state={isExpanded:void 0},this.parseClick=(e,t)=>{const{router:s}=this.context,{lastStatus:a,unread:o,markRead:n}=this.props;s&&(0!==e.button||e.ctrlKey||e.altKey||e.metaKey||(void 0===t&&(o&&n(),t=`/statuses/${a.get("id")}`),s.history.push(t),e.preventDefault()))},this.handleMouseEnter=e=>{let{currentTarget:t}=e;if(E.a)return;const s=t.querySelectorAll(".custom-emoji");for(var a=0;a<s.length;a++){let e=s[a];e.src=e.getAttribute("data-original")}},this.handleMouseLeave=e=>{let{currentTarget:t}=e;if(E.a)return;const s=t.querySelectorAll(".custom-emoji");for(var a=0;a<s.length;a++){let e=s[a];e.src=e.getAttribute("data-static")}},this.handleClick=()=>{if(!this.context.router)return;const{lastStatus:e,unread:t,markRead:s}=this.props;t&&s(),this.context.router.history.push(`/@${e.getIn(["account","acct"])}/${e.get("id")}`)},this.handleMarkAsRead=()=>{this.props.markRead()},this.handleReply=()=>{this.props.reply(this.props.lastStatus,this.context.router.history)},this.handleDelete=()=>{this.props.delete()},this.handleHotkeyMoveUp=()=>{this.props.onMoveUp(this.props.conversationId)},this.handleHotkeyMoveDown=()=>{this.props.onMoveDown(this.props.conversationId)},this.handleConversationMute=()=>{this.props.onMute(this.props.lastStatus)},this.handleShowMore=()=>{this.props.onToggleHidden(this.props.lastStatus),this.props.lastStatus.get("spoiler_text")&&this.setExpansion(!this.state.isExpanded)},this.setExpansion=e=>{this.setState({isExpanded:e})}}render(){const{accounts:e,lastStatus:t,unread:s,scrollKey:o,intl:n}=this.props;if(null===t)return null;const r=this.props.settings.getIn(["content_warnings","shared_state"])?!t.get("hidden"):this.state.isExpanded,c=[{text:n.formatMessage(F.open),action:this.handleClick},null];c.push({text:n.formatMessage(t.get("muted")?F.unmuteConversation:F.muteConversation),action:this.handleConversationMute}),s&&(c.push({text:n.formatMessage(F.markAsRead),action:this.handleMarkAsRead}),c.push(null)),c.push({text:n.formatMessage(F.delete),action:this.handleDelete});const d=e.map((e=>Object(a.a)(z.a,{to:`/@${e.get("acct")}`,href:e.get("url"),title:e.get("acct")},e.get("id"),Object(a.a)("bdi",{},void 0,Object(a.a)("strong",{className:"display-name__html",dangerouslySetInnerHTML:{__html:e.get("display_name_html")}}))))).reduce(((e,t)=>[e,", ",t])),l={reply:this.handleReply,open:this.handleClick,moveUp:this.handleHotkeyMoveUp,moveDown:this.handleHotkeyMoveDown,toggleHidden:this.handleShowMore};let h=null;return t.get("media_attachments").size>0&&(h=Object(a.a)($.a,{compact:!0,media:t.get("media_attachments")})),Object(a.a)(U.HotKeys,{handlers:l},void 0,Object(a.a)("div",{className:H()("conversation focusable muted",{"conversation--unread":s}),tabIndex:0},void 0,Object(a.a)("div",{className:"conversation__avatar",onClick:this.handleClick,role:"presentation"},void 0,Object(a.a)(K,{accounts:e,size:48})),Object(a.a)("div",{className:"conversation__content"},void 0,Object(a.a)("div",{className:"conversation__content__info"},void 0,Object(a.a)("div",{className:"conversation__content__relative-time"},void 0,s&&Object(a.a)("span",{className:"conversation__unread"})," ",Object(a.a)(W.a,{timestamp:t.get("created_at")})),Object(a.a)("div",{className:"conversation__content__names",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},void 0,Object(a.a)(i.a,{id:"conversation.with",defaultMessage:"With {names}",values:{names:Object(a.a)("span",{},void 0,d)}}))),Object(a.a)(B.a,{status:t,parseClick:this.parseClick,expanded:r,onExpandedToggle:this.handleShowMore,collapsible:!0,media:h}),Object(a.a)("div",{className:"status__action-bar"},void 0,Object(a.a)(A.a,{className:"status__action-bar-button",title:n.formatMessage(F.reply),icon:"reply",onClick:this.handleReply}),Object(a.a)("div",{className:"status__action-bar-dropdown"},void 0,Object(a.a)(V.a,{scrollKey:o,status:t,items:c,icon:"ellipsis-h",size:18,direction:"right",title:n.formatMessage(F.more)}))))))}}J.contextTypes={router:k.a.object},J.propTypes={conversationId:k.a.string.isRequired,accounts:R.a.list.isRequired,lastStatus:R.a.map,unread:k.a.bool.isRequired,scrollKey:k.a.string,onMoveUp:k.a.func,onMoveDown:k.a.func,markRead:k.a.func.isRequired,delete:k.a.func.isRequired,intl:k.a.object.isRequired};var Y=Object(r.c)(J);const G=Object(n.d)({replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"}});var Q=Object(r.c)(Object(d.connect)((()=>{const e=Object(P.i)();return(t,s)=>{let{conversationId:a}=s;const o=t.getIn(["conversations","items"]).find((e=>e.get("id")===a)),n=o.get("last_status",null);return{accounts:o.get("accounts").map((e=>t.getIn(["accounts",e],null))),unread:o.get("unread"),lastStatus:n&&e(t,{id:n}),settings:t.get("local_settings")}}}),((e,t)=>{let{intl:s,conversationId:a}=t;return{markRead(){e(Object(h.k)(a))},reply(t,a){e(((o,n)=>{0!==n().getIn(["compose","text"]).trim().length?e(Object(N.b)({modalType:"CONFIRM",modalProps:{message:s.formatMessage(G.replyMessage),confirm:s.formatMessage(G.replyConfirm),onConfirm:()=>e(Object(D.Bb)(t,a))}})):e(Object(D.Bb)(t,a))}))},delete(){e(Object(h.i)(a))},onMute(t){t.get("muted")?e(Object(S.t)(t.get("id"))):e(Object(S.p)(t.get("id")))},onToggleHidden(t){t.get("hidden")?e(Object(S.q)(t.get("id"))):e(Object(S.o)(t.get("id")))}}}))(Y)),X=s(6);class Z extends L.a{constructor(){super(...arguments),this.getCurrentIndex=e=>this.props.conversations.findIndex((t=>t.get("id")===e)),this.handleMoveUp=e=>{const t=this.getCurrentIndex(e)-1;this._selectChild(t,!0)},this.handleMoveDown=e=>{const t=this.getCurrentIndex(e)+1;this._selectChild(t,!1)},this.setRef=e=>{this.node=e},this.handleLoadOlder=w()((()=>{const e=this.props.conversations.last();e&&e.get("last_status")&&this.props.onLoadMore(e.get("last_status"))}),300,{leading:!0})}_selectChild(e,t){const s=this.node.node,a=s.querySelector(`article:nth-of-type(${e+1}) .focusable`);a&&(t&&s.scrollTop>a.offsetTop?a.scrollIntoView(!0):!t&&s.scrollTop+s.clientHeight<a.offsetTop+a.offsetHeight&&a.scrollIntoView(!1),a.focus())}render(){const{conversations:e,isLoading:t,onLoadMore:s,...o}=this.props;return Object(X.jsx)(T.a,{...o,isLoading:t,showLoading:t&&e.isEmpty(),onLoadMore:s&&this.handleLoadOlder,ref:this.setRef,children:e.map((e=>Object(a.a)(Q,{conversationId:e.get("id"),onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,scrollKey:this.props.scrollKey},e.get("id"))))})}}Z.propTypes={conversations:R.a.list.isRequired,scrollKey:k.a.string.isRequired,hasMore:k.a.bool,isLoading:k.a.bool,onLoadMore:k.a.func};var ee=Object(d.connect)((e=>({conversations:e.getIn(["conversations","items"]),isLoading:e.getIn(["conversations","isLoading"],!0),hasMore:e.getIn(["conversations","hasMore"],!1)})),(e=>({onLoadMore:t=>e(Object(h.j)({maxId:t}))})))(Z);const te=Object(n.d)({title:{id:"column.direct",defaultMessage:"Private mentions"}});class se extends o.PureComponent{constructor(){super(...arguments),this.handlePin=()=>{const{columnId:e,dispatch:t}=this.props;t(e?Object(l.h)(e):Object(l.e)("DIRECT",{}))},this.handleMove=e=>{const{columnId:t,dispatch:s}=this.props;s(Object(l.g)(t,e))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=e=>{this.column=e},this.handleLoadMoreTimeline=e=>{this.props.dispatch(Object(u.t)({maxId:e}))},this.handleLoadMoreConversations=e=>{this.props.dispatch(Object(h.j)({maxId:e}))}}componentDidMount(){const{dispatch:e,conversationsMode:t}=this.props;e(Object(h.l)()),e(t?Object(h.j)():Object(u.t)()),this.disconnect=e(Object(p.b)())}componentDidUpdate(e){const{dispatch:t,conversationsMode:s}=this.props;e.conversationsMode&&!s?t(Object(u.t)()):!e.conversationsMode&&s&&t(Object(h.j)())}componentWillUnmount(){this.props.dispatch(Object(h.m)()),this.disconnect&&(this.disconnect(),this.disconnect=null)}render(){const{intl:e,hasUnread:t,columnId:s,multiColumn:o,conversationsMode:n}=this.props,r=!!s;let d;return d=n?Object(a.a)(ee,{trackScroll:!r,scrollKey:`direct_timeline-${s}`,timelineId:"direct",bindToDocument:!o,onLoadMore:this.handleLoadMore,prepend:Object(a.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(a.a)("span",{},void 0,Object(a.a)(i.a,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(a.a)("a",{href:"/terms",target:"_blank"},void 0,Object(a.a)(i.a,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),alwaysPrepend:!0,emptyMessage:Object(a.a)(i.a,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."})}):Object(a.a)(v.a,{trackScroll:!r,scrollKey:`direct_timeline-${s}`,timelineId:"direct",bindToDocument:!o,onLoadMore:this.handleLoadMoreTimeline,prepend:Object(a.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(a.a)("span",{},void 0,Object(a.a)(i.a,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(a.a)("a",{href:"/terms",target:"_blank"},void 0,Object(a.a)(i.a,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),alwaysPrepend:!0,emptyMessage:Object(a.a)(i.a,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."})}),Object(X.jsxs)(m.a,{bindToDocument:!o,ref:this.setRef,label:e.formatMessage(te.title),children:[Object(a.a)(g.a,{icon:"envelope",active:t,title:e.formatMessage(te.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:r,multiColumn:o},void 0,Object(a.a)(y,{})),d,Object(a.a)(c.a,{},void 0,Object(a.a)("title",{},void 0,e.formatMessage(te.title)),Object(a.a)("meta",{name:"robots",content:"noindex"}))]})}}t.default=Object(d.connect)((e=>({hasUnread:e.getIn(["timelines","direct","unread"])>0,conversationsMode:e.getIn(["settings","direct","conversations"])})))(Object(r.c)(se))}}]);
//# sourceMappingURL=direct_timeline.js.map