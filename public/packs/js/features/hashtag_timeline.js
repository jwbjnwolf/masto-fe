(window.webpackJsonp=window.webpackJsonp||[]).push([[480],{1574:function(t,e,a){"use strict";a.r(e);var s=a(0),n=a(1686),o=a.n(n),i=a(3),l=a.n(i),c=a(2),d=a(22),h=a(126),r=a(9),g=a(898),u=a(1391),p=a(587),m=a(44),b=a(1036),O=a(1389),j=a(1669),_=a(7),v=a(28),f=a(62),y=a(124);const M=Object(_.d)({followHashtag:{id:"hashtag.follow",defaultMessage:"Follow hashtag"},unfollowHashtag:{id:"hashtag.unfollow",defaultMessage:"Unfollow hashtag"}}),w=(t,e)=>Object(s.a)(d.a,{id:"hashtag.counter_by_uses",defaultMessage:"{count, plural, one {{counter} post} other {{counter} posts}}",values:{count:e,counter:Object(s.a)("strong",{},void 0,t)}}),I=(t,e)=>Object(s.a)(d.a,{id:"hashtag.counter_by_accounts",defaultMessage:"{count, plural, one {{counter} participant} other {{counter} participants}}",values:{count:e,counter:Object(s.a)("strong",{},void 0,t)}}),C=(t,e)=>Object(s.a)(d.a,{id:"hashtag.counter_by_uses_today",defaultMessage:"{count, plural, one {{counter} post} other {{counter} posts}} today",values:{count:e,counter:Object(s.a)("strong",{},void 0,t)}}),N=Object(v.c)((t=>{let{tag:e,intl:a,disabled:n,onClick:o}=t;if(!e)return null;const[i,l]=e.get("history").reduce(((t,e)=>[t[0]+1*e.get("uses"),t[1]+1*e.get("accounts")]),[0,0]),c=Object(s.a)("span",{"aria-hidden":!0},void 0," · ");return Object(s.a)("div",{className:"hashtag-header"},void 0,Object(s.a)("div",{className:"hashtag-header__header"},void 0,Object(s.a)("h1",{},void 0,"#",e.get("name")),Object(s.a)(f.a,{onClick:o,text:a.formatMessage(e.get("following")?M.unfollowHashtag:M.followHashtag),disabled:n})),Object(s.a)("div",{},void 0,Object(s.a)(y.a,{value:i,renderer:w}),c,Object(s.a)(y.a,{value:l,renderer:I}),c,Object(s.a)(y.a,{value:1*e.getIn(["history",0,"uses"]),renderer:C})))}));var x=a(13),S=a(1687),k=a(1704),F=a(967),T=a.n(F),$=a(1668);const H=Object(_.d)({placeholder:{id:"hashtag.column_settings.select.placeholder",defaultMessage:"Enter hashtags…"},noOptions:{id:"hashtag.column_settings.select.no_options_message",defaultMessage:"No suggestions found"}});class L extends c.PureComponent{constructor(){super(...arguments),this.state={open:this.hasTags()},this.onSelect=t=>e=>{const a=this.tags(t);e.length>4&&!(e<a)||this.props.onChange(["tags",t],e)},this.onToggle=()=>{this.state.open&&this.hasTags()&&this.props.onChange("tags",{}),this.setState({open:!this.state.open})},this.noOptionsMessage=()=>this.props.intl.formatMessage(H.noOptions)}hasTags(){return["all","any","none"].map((t=>this.tags(t).length>0)).includes(!0)}tags(t){let e=this.props.settings.getIn(["tags",t])||[];return e.toJS?e.toJS():e}modeSelect(t){return Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)("span",{className:"column-settings__section"},void 0,this.modeLabel(t)),Object(s.a)(S.a,{nonce:document.querySelector("meta[name=style-nonce]").content,cacheKey:"tags"},void 0,Object(s.a)(k.a,{isMulti:!0,autoFocus:!0,value:this.tags(t),onChange:this.onSelect(t),loadOptions:this.props.onLoad,className:"column-select__container",classNamePrefix:"column-select",name:"tags",placeholder:this.props.intl.formatMessage(H.placeholder),noOptionsMessage:this.noOptionsMessage})))}modeLabel(t){switch(t){case"any":return Object(s.a)(d.a,{id:"hashtag.column_settings.tag_mode.any",defaultMessage:"Any of these"});case"all":return Object(s.a)(d.a,{id:"hashtag.column_settings.tag_mode.all",defaultMessage:"All of these"});case"none":return Object(s.a)(d.a,{id:"hashtag.column_settings.tag_mode.none",defaultMessage:"None of these"});default:return""}}render(){const{settings:t,onChange:e}=this.props;return Object(s.a)("div",{},void 0,Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)("div",{className:"setting-toggle"},void 0,Object(s.a)(T.a,{id:"hashtag.column_settings.tag_toggle",onChange:this.onToggle,checked:this.state.open}),Object(s.a)("span",{className:"setting-toggle__label"},void 0,Object(s.a)(d.a,{id:"hashtag.column_settings.tag_toggle",defaultMessage:"Include additional tags in this column"})))),this.state.open&&Object(s.a)("div",{className:"column-settings__hashtags"},void 0,this.modeSelect("any"),this.modeSelect("all"),this.modeSelect("none")),Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)($.a,{settings:t,settingPath:["local"],onChange:e,label:Object(s.a)(d.a,{id:"community.column_settings.local_only",defaultMessage:"Local only"})})))}}var P=Object(v.c)(L);var U=Object(r.connect)(((t,e)=>{let{columnId:a}=e;const s=t.getIn(["settings","columns"]),n=s.findIndex((t=>t.get("uuid")===a));return a&&n>=0?{settings:s.get(n).get("params"),onLoad:e=>Object(x.a)((()=>t)).get("/api/v2/search",{params:{q:e,type:"hashtags"}}).then((t=>(t.data.hashtags||[]).map((t=>({value:t.name,label:`#${t.name}`})))))}:{}}),((t,e)=>{let{columnId:a}=e;return{onChange(e,s){t(Object(g.f)(a,e,s))}}}))(P),A=a(6);class D extends c.PureComponent{constructor(){super(...arguments),this.disconnects=[],this.handlePin=()=>{const{columnId:t,dispatch:e}=this.props;e(t?Object(g.h)(t):Object(g.e)("HASHTAG",{id:this.props.params.id}))},this.title=()=>{const{id:t}=this.props.params,e=[t];return this.additionalFor("any")&&e.push(" ",Object(s.a)(d.a,{id:"hashtag.column_header.tag_mode.any",values:{additional:this.additionalFor("any")},defaultMessage:"or {additional}"},"any")),this.additionalFor("all")&&e.push(" ",Object(s.a)(d.a,{id:"hashtag.column_header.tag_mode.all",values:{additional:this.additionalFor("all")},defaultMessage:"and {additional}"},"all")),this.additionalFor("none")&&e.push(" ",Object(s.a)(d.a,{id:"hashtag.column_header.tag_mode.none",values:{additional:this.additionalFor("none")},defaultMessage:"without {additional}"},"none")),e},this.additionalFor=t=>{const{tags:e}=this.props.params;return e&&(e[t]||[]).length>0?e[t].map((t=>t.value)).join("/"):""},this.handleMove=t=>{const{columnId:e,dispatch:a}=this.props;a(Object(g.g)(e,t))},this.handleHeaderClick=()=>{this.column.scrollTop()},this.setRef=t=>{this.column=t},this.handleLoadMore=t=>{const{dispatch:e,params:a}=this.props,{id:s,tags:n,local:o}=a;e(Object(m.t)(s,{maxId:t,tags:n,local:o}))},this.handleFollow=()=>{const{dispatch:t,params:e,tag:a}=this.props,{id:s}=e,{signedIn:n}=this.context.identity;n&&(a.get("following")?t(Object(p.p)(s)):t(Object(p.o)(s)))}}_subscribe(t,e,a,s){void 0===a&&(a={});const{signedIn:n}=this.context.identity;if(!n)return;let o=(a.any||[]).map((t=>t.value)),i=(a.all||[]).map((t=>t.value)),l=(a.none||[]).map((t=>t.value));[e,...o].map((a=>{this.disconnects.push(t(Object(u.c)(e,a,s,(t=>{let e=t.tags.map((t=>t.name));return i.filter((t=>e.includes(t))).length===i.length&&0===l.filter((t=>e.includes(t))).length}))))}))}_unsubscribe(){this.disconnects.map((t=>t())),this.disconnects=[]}_unload(){const{dispatch:t}=this.props,{id:e,local:a}=this.props.params;this._unsubscribe(),t(Object(m.l)(`hashtag:${e}${a?":local":""}`))}_load(){const{dispatch:t}=this.props,{id:e,tags:a,local:s}=this.props.params;this._subscribe(t,e,a,s),t(Object(m.t)(e,{tags:a,local:s})),t(Object(p.n)(e))}componentDidMount(){this._load()}componentDidUpdate(t){const{params:e}=this.props,{id:a,tags:s,local:n}=t.params;a===e.id&&o()(s,e.tags)&&o()(n,e.local)||(this._unload(),this._load())}componentWillUnmount(){this._unsubscribe()}render(){const{hasUnread:t,columnId:e,multiColumn:a,tag:n}=this.props,{id:o,local:i}=this.props.params,l=!!e,{signedIn:c}=this.context.identity;return Object(A.jsxs)(b.a,{bindToDocument:!a,ref:this.setRef,label:`#${o}`,children:[Object(s.a)(O.a,{icon:"hashtag",active:t,title:this.title(),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:l,multiColumn:a,showBackButton:!0},void 0,e&&Object(s.a)(U,{columnId:e})),Object(s.a)(j.a,{prepend:l?null:Object(s.a)(N,{tag:n,disabled:!c,onClick:this.handleFollow}),alwaysPrepend:!0,trackScroll:!l,scrollKey:`hashtag_timeline-${e}`,timelineId:`hashtag:${o}${i?":local":""}`,onLoadMore:this.handleLoadMore,emptyMessage:Object(s.a)(d.a,{id:"empty_column.hashtag",defaultMessage:"There is nothing in this hashtag yet."}),bindToDocument:!a}),Object(s.a)(h.a,{},void 0,Object(s.a)("title",{},void 0,"#",o),Object(s.a)("meta",{name:"robots",content:"noindex"}))]})}}D.contextTypes={identity:l.a.object};e.default=Object(r.connect)(((t,e)=>({hasUnread:t.getIn(["timelines",`hashtag:${e.params.id}${e.params.local?":local":""}`,"unread"])>0,tag:t.getIn(["tags",e.params.id])})))(D)}}]);
//# sourceMappingURL=hashtag_timeline.js.map